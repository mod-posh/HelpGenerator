# ADR-009 — Validation Rules and Severity Levels

**Status:** Accepted
**Date:** 2026-02-20

---

## Context

The Help Generator suite produces:

* MAML external help
* HelpInfo.xml
* Markdown documentation
* Updatable help packaging structure

To ensure correctness, determinism, and PowerShell compatibility, the suite must validate:

* Structural integrity
* Schema compliance
* Semantic completeness
* Authoring quality

However, not all validation issues should block generation. Some issues represent fatal errors; others represent incomplete documentation that should only warn the developer.

This ADR defines:

* Validation categories
* Severity levels
* Default behaviors
* CI integration expectations

---

## Decision

Validation is divided into three layers:

1. **Structural Validation**
2. **Schema Validation**
3. **Semantic Validation**

Each rule produces a severity:

* `Error` (generation must fail)
* `Warning` (generation succeeds but reports issue)
* `Info` (non-blocking informational message)

---

### 1. Structural Validation

Structural validation ensures the Normalized Help Model is internally consistent.

These are **Errors**:

* Duplicate command names (case-insensitive)
* Duplicate parameter names within a command
* Parameter referenced in a ParameterSet but not defined
* ParameterSet marked as default but multiple default sets exist
* Missing required model properties:

  * Command `Name`
  * Command `Verb` or `Noun`
  * Module `Name`
  * Module `Guid` (when generating HelpInfo.xml)
* Invalid culture identifier format
* HelpVersion missing when generating updatable help

These are **Warnings**:

* Command has no examples
* Command has no output type defined
* Parameter has no description (but placeholder exists)
* Synopsis is placeholder text
* Description missing entirely
* HelpContentUri not provided (if HelpInfo generation requested but not explicitly required)

---

### 2. Schema Validation

Schema validation applies to generated XML artifacts.

## HelpInfo.xml

**Errors:**

* XML fails XSD validation
* Missing required nodes
* Culture entries missing required attributes
* Invalid version format
* HelpContentUri malformed

**Warnings:**

* HelpVersion equals module version (allowed but flagged for clarity)
* Multiple cultures share identical HelpVersion (allowed but flagged)

---

## MAML

**Errors:**

* XML not well-formed
* Missing required `<details>` node
* Missing `<syntax>` node
* Invalid nesting structure
* Schema validation failure (if XSD available)

**Warnings:**

* Empty `<examples>` section omitted
* Parameter has no description
* Return type has no description

---

### 3. Semantic Validation

Semantic validation enforces PowerShell conventions and authoring quality.

## Command Naming

**Errors:**

* Verb not in approved PowerShell verb list (configurable strict mode)
* Command name missing dash (`-`)

**Warnings:**

* Non-standard verb (if not strict mode)
* Noun contains invalid characters
* Alias conflicts with another command

---

## Parameter Quality

**Warnings:**

* Mandatory parameter without description
* Switch parameter documented with type prose that contradicts switch behavior
* Parameter description shorter than configurable minimum length
* Default value documented but not reflected in metadata (compiled cmdlets only)

---

## Example Quality

**Warnings:**

* Example contains no code
* Example code does not contain command name
* Duplicate example titles

---

## Localization

**Errors:**

* Culture listed in HelpInfo.xml but no corresponding MAML file generated

**Warnings:**

* Culture missing localized text and falling back to default
* Inconsistent HelpVersion across cultures

---

##

Placeholders are allowed but flagged.

Placeholder-related rules:

| Condition                                               | Severity                     |
| ------------------------------------------------------- | ---------------------------- |
| Placeholder Synopsis                                    | Warning                      |
| Placeholder Parameter Description                       | Warning                      |
| Entire Command fully placeholder                        | Warning                      |
| Placeholder in release mode (configurable strict build) | Error (optional strict mode) |

This allows:

* Development scaffolding
* Strict CI enforcement in production pipelines

---

### 5. Validation Execution Model

Validation runs in three phases:

1. Model validation (before generation)
2. Artifact validation (after generation)
3. Packaging validation (when building updatable help structure)

Validation results are aggregated into a structured report:

```json
{
  "Errors": [],
  "Warnings": [],
  "Info": []
}
```

---

### 6. CLI / Cmdlet Behavior

Default behavior:

* Errors stop generation.
* Warnings do not stop generation.
* Exit code non-zero if Errors > 0.

Optional switches:

* `-TreatWarningsAsErrors`
* `-Strict` (enables stricter semantic rules)
* `-Quiet`
* `-VerboseValidation`

---

### 7. CI Integration Expectations

In CI environments:

Recommended default:

* Fail on Errors
* Warn on Warnings
* Optionally treat warnings as errors for release builds

The suite must expose:

* Machine-readable validation output (JSON)
* Human-readable summary (console format)
* Deterministic ordering of reported issues

---

### 8. Guardrails

Validation must not:

* Modify source content automatically
* Rewrite prose
* Attempt to “fix” grammar
* Infer missing descriptions
* Reorder author-intended examples

Validation reports problems; generation remains deterministic.

---

### Rationale

Clear validation tiers:

* Prevent invalid artifacts
* Encourage high-quality documentation
* Support scaffolding workflows
* Enable strict CI enforcement
* Avoid silent generation of broken help

---

### Consequences

Positive:

* Strong quality guarantees
* Predictable CI behavior
* Clear separation between correctness and quality

Trade-offs:

* Additional complexity in rule engine
* Requires documentation of severity expectations
