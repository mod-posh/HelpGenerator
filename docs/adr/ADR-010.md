# ADR-010 — HelpInfo.xml and Updatable Help Packaging Contract

**Status:** Accepted
**Date:** 2026-02-20

---

## Context

The Help Generator suite must support:

* Generation of HelpInfo.xml
* Generation of external help (MAML)
* Packaging for PowerShell updatable help (CAB-based distribution)
* Deterministic, testable output structure

PowerShell’s `Update-Help` mechanism relies on:

* HelpInfo.xml metadata
* Versioned help content per culture
* Downloadable CAB files
* Consistent module GUID + module name alignment

To avoid ambiguity and distribution inconsistencies, this ADR defines:

* HelpInfo.xml contract
* Versioning rules
* CAB naming conventions
* Folder layout requirements
* Packaging assumptions

---

### 1. HelpInfo.xml Contract

HelpInfo.xml is generated from the `ModuleHelp` model.

Minimum required structure:

```xml
<HelpInfo>
  <HelpContentUri>https://example.com/help</HelpContentUri>
  <SupportedCultures>
    <Culture>
      <CultureName>en-US</CultureName>
      <HelpVersion>1.0.0.0</HelpVersion>
    </Culture>
  </SupportedCultures>
</HelpInfo>
```

If multiple cultures:

```xml
<Culture>
  <CultureName>fr-FR</CultureName>
  <HelpVersion>1.0.0.0</HelpVersion>
</Culture>
```

---

## Required Fields

* `HelpContentUri`
* At least one `Culture`
* `HelpVersion` per culture

---

## Not Included in HelpInfo.xml

HelpInfo.xml does **not** contain:

* Command help content
* Module description prose
* Parameter descriptions
* Examples

It is strictly metadata for locating versioned help payloads.

---

### 2. Versioning Rules

We distinguish between:

* Module Version
* Help Version

#### Module Version

From:

* `.psd1` manifest
* Assembly version (compiled modules)
* Explicit user override

#### Help Version

HelpVersion is independently managed and:

* Must be in `Major.Minor.Build.Revision` format
* Must increment when help content changes
* Does not have to match module version

---

#### Versioning Guardrails

Errors:

* HelpVersion missing
* HelpVersion invalid format
* HelpVersion decreases between generations (if baseline provided)

Warnings:

* HelpVersion equals Module Version (allowed but flagged)
* HelpVersion unchanged but content changed (if diff detectable)

---

## 3. External Help (MAML) Layout

Generated MAML layout:

```bash
/help
  /en-US
    <ModuleName>-Help.xml
  /fr-FR
    <ModuleName>-Help.xml
```

Rules:

* Exactly one MAML file per culture.
* File name must match module name exactly.
* Culture folder must match CultureName in HelpInfo.xml.

---

## 4. CAB Packaging Contract

CAB files are culture-specific.

Naming convention:

```bash
<ModuleName>_<HelpVersion>_<Culture>.cab
```

Example:

```bash
MyModule_1.0.0.0_en-US.cab
```

CAB contents:

```bash
<ModuleName>-Help.xml
```

Only the MAML file for that culture is included.

No nested folders inside CAB.

---

### Packaging Folder Layout

When generating updatable help output:

```bash
/updatable-help
  HelpInfo.xml
  /en-US
    MyModule_1.0.0.0_en-US.cab
  /fr-FR
    MyModule_1.0.0.0_fr-FR.cab
```

This structure is deterministic and testable.

---

## 5. GUID Alignment Requirement

If module manifest exists:

* `ModuleHelp.Guid` must match `.psd1` GUID.

If compiled module:

* GUID must be provided explicitly or sourced from manifest.

Error if:

* GUID missing when generating HelpInfo.xml.
* GUID mismatch detected (optional strict validation).

---

## 6. HelpContentUri Strategy

HelpContentUri is the base URL where:

* HelpInfo.xml is hosted
* CAB files are hosted

The suite does not:

* Host content
* Upload content
* Generate static websites

It only validates:

* URI format
* That CAB names match declared versions

---

## 7. Packaging Execution Modes

We support two modes:

### 1. Generate Only

* Produces MAML + HelpInfo.xml
* Does not build CAB

### 2. Package Mode

* Produces CAB files
* Produces full updatable-help folder structure

Switch example:

```powershell
Export-HelpPackage -Module MyModule -Package
```

---

## 8. Validation Requirements

Packaging validation includes:

Errors:

* Missing MAML file for culture listed in HelpInfo.xml
* Missing CAB file when packaging enabled
* CAB filename mismatch with HelpVersion
* Culture mismatch between folder and HelpInfo.xml entry

Warnings:

* HelpContentUri not HTTPS
* Multiple cultures share identical help payload hash (informational)

---

## 9. Determinism Requirements

The following must be deterministic:

* HelpInfo.xml element ordering
* Culture ordering (alphabetical)
* CAB naming
* Folder structure
* XML indentation and attribute ordering

Golden fixture tests must compare entire folder trees exactly.

---

## 10. Guardrails

The suite does not:

* Publish help to servers
* Modify module manifests automatically
* Auto-bump HelpVersion
* Generate hosting configurations
* Integrate with NuGet or PowerShell Gallery publishing

Distribution automation is external to this project.

---

## Rationale

Separating help packaging from publishing:

* Keeps scope tight
* Keeps tool deterministic
* Avoids platform-specific deployment logic
* Ensures updatable help compatibility without drift

---

## Consequences

Positive:

* Predictable updatable help structure
* Clear separation between content and distribution
* CI-friendly packaging
* Clean release workflow

Trade-offs:

* Requires external hosting solution
* HelpVersion discipline is developer-managed
